= Priority Work Items

Date: 2026-02-15

This file tracks only unfinished, high-impact work.

== P0 (Do Next)

1. Extract shared stream runtime in `replication-core`
- Add common lifecycle/retry/subscription/preflight runtime used by all adapters.
- Goal: reduce copy/paste across `*LogicalReplicationStream` implementations.

== In Progress

1. Shared runtime extraction + JDBC base rollout
- Added `AbstractJdbcPollingReplicationStream` in `replication-core`.
- Migrated `replication-oracle`, `replication-db2`, `replication-mariadb`, and `replication-cockroachdb` logical streams to the shared base.
- Remaining shared-runtime rollout targets: `replication-cassandra`, `replication-scylladb`, `replication-sqlserver`, `replication-mongodb`, `replication-mysql`.

== Explicitly Not Tracked Here

- Already completed fixes (for example SQL Server tuple checkpoint token and batch paging correctness improvements) are intentionally excluded.

== Completed

1. SQL Server developer ergonomics parity
- Added typed field helpers on `SqlServerChangeEvent` (`rowOrBefore`, `string`, `integer`, `longValue`, `decimal`, `doubleValue`).
- Added sync-handler overload for `startAndSubscribe(...)`.
- Added `SqlServerReplicationAppConfig` and `SqlServerReplicationOptionPresets` with tests.

2. Shared JDBC polling base migration
- Introduced `AbstractJdbcPollingReplicationStream` in `replication-core`.
- Completed migration of `replication-oracle`, `replication-db2`, `replication-mariadb`, and `replication-cockroachdb`.

3. Typed startup/preflight exception
- Added `PreflightFailedException` carrying `PreflightReport` and `ReplicationStreamState`.
- Wired all adapters to fail preflight with this typed exception.

4. Legacy monolith cleanup
- Confirmed `src-legacy-monolith` is removed and not referenced by module builds.

5. SQL Server commit timestamp enrichment
- Enriched SQL Server CDC query with `sys.fn_cdc_map_lsn_to_time(__$start_lsn)`.
- `SqlServerChangeEvent#commitTimestamp` is now populated from CDC metadata when available.

6. Adapter contract test kit
- Added shared `ReplicationStreamContractKit` in `replication-core`.
- Adopted contract tests for all adapters:
  `replication-postgres`, `replication-mysql`, `replication-mongodb`, `replication-oracle`,
  `replication-db2`, `replication-mariadb`, `replication-cockroachdb`, `replication-sqlserver`,
  `replication-cassandra`, `replication-scylladb`, and `replication-neo4j`.

7. Option validation unification
- Added shared `OptionValidation` helper in `replication-core`.
- Migrated validation logic for all adapter options:
  `replication-postgres`, `replication-mysql`, `replication-mongodb`, `replication-oracle`,
  `replication-db2`, `replication-mariadb`, `replication-cockroachdb`, `replication-sqlserver`,
  `replication-cassandra`, `replication-scylladb`, and `replication-neo4j`.
